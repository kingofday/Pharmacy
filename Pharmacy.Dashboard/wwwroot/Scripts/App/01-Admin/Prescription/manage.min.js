var items=[];$(document).ready(function(){$(document).on("click","#btn-add-item",function(){var i,n;let u=$(this),f=u.closest("form");if(f.valid()){let t=$("#modal #Count").val();if(isNaN(t)){showNotif(notifyType.danger,validationMessages.number);return}if(parseInt(t)<1){showNotif(notifyType.danger,"حداقل تعداد یک می باشد");return}i=(n,t,i,r)=>`<tr class="new-item" data-price="${i}" data-discount="${r}" data-count="${t}">
                            <td>${n}</td>
                            <td>${t}</td>
                            <td>${commaThousondSeperator(r)}</td>
                            <td>${commaThousondSeperator(i)}</td>
                            <td><i class="delete-item zmdi zmdi-delete default-i"></td>
                        </tr>`;let r=$('#modal select[name="DrugId"]');if(n=r.select2("data"),n[0].id){let f=0,u=0,e=0;$("#items tr").each(function(){u=$(this).data("price");e=$(this).data("discount");u&&(f+=(u-e)*t)});$(i(n[0].text,t,n[0].Price,n[0].DiscountPrice)).insertBefore($("tr.tr-total"));items.push({DrugId:n[0].id,Count:t});r.val(null).trigger("change");$("#total-price").text(commaThousondSeperator(f+n[0].Price*t)+strings.moneyCurrency)}}});$(document).on("click",".delete-item",function(){let n=$(this).closest("tr"),t=$(this).data("url");if(t)ajaxActionLink.inProgress(n),$.post(t).done(function(t){ajaxActionLink.normal();t.IsSuccessful?(n.remove(),$("#items").replaceWith(t.Result)):showNotif(notifyType.danger,t.Message)}).fail(function(){ajaxActionLink.normal();showNotif(notifyType.danger,strings.error)});else{let t=$(".new-item").index(n);items.splice(t,1);n.remove()}});$(document).on("click",".btn-submit",function(n){n.stopPropagation();let t=$(this),i=t.closest("form"),r=customSerialize(i);r.Items=items;ajaxBtn.inProgress(t);$.ajax({type:"POST",url:i.attr("action"),data:r,success:function(n){ajaxBtn.normal();n.IsSuccessful?$("#modal").modal("hide"):showNotif(notifyType.danger,n.Message)},error:function(){ajaxBtn.normal()}})});$(document).on("click","#btn-send-link",function(){let n=$(this);ajaxBtn.inProgress(n);$.post(n.data("url")).done(function(n){ajaxBtn.normal();n.IsSuccessful?showNotif(notifyType.success,n.Message):showNotif(notifyType.danger,n.Message)}).fail(function(){ajaxBtn.normal()})})});